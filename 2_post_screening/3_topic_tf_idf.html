<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="O’Hara">

<title>Examine TF-IDF on documents by topic</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="3_topic_tf_idf_files/libs/clipboard/clipboard.min.js"></script>
<script src="3_topic_tf_idf_files/libs/quarto-html/quarto.js"></script>
<script src="3_topic_tf_idf_files/libs/quarto-html/popper.min.js"></script>
<script src="3_topic_tf_idf_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="3_topic_tf_idf_files/libs/quarto-html/anchor.min.js"></script>
<link href="3_topic_tf_idf_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="3_topic_tf_idf_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="3_topic_tf_idf_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="3_topic_tf_idf_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="3_topic_tf_idf_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="3_topic_tf_idf_files/libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="3_topic_tf_idf_files/libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="3_topic_tf_idf_files/libs/datatables-binding-0.30/datatables.js"></script>
<script src="3_topic_tf_idf_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="3_topic_tf_idf_files/libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="3_topic_tf_idf_files/libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="3_topic_tf_idf_files/libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script>
<link href="3_topic_tf_idf_files/libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="3_topic_tf_idf_files/libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Examine TF-IDF on documents by topic</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>O’Hara </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="fu">here</span>(<span class="st">'common_fxns.R'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here we will iterate topic-by-topic to identify, using the TF-IDF concept, words and bigrams that are particularly important for a small number of articles, as well as those that come up frequently across all articles in the topic.</p>
<ul>
<li>The TF-IDF analysis identifies words that are uncommon across the articles, but show up frequently in one or two articles. This may show odd terms that indicate articles that came up in the search but are focused on something else entirely.</li>
<li>A term frequency analysis can highlight terms that show up commonly across the corpus, perhaps revealing commonalities. This will be useful when looking at “value” related terms and bigrams in particular.</li>
</ul>
<section id="load-search-results-and-lda-results" class="level2">
<h2 class="anchored" data-anchor-id="load-search-results-and-lda-results">Load search results and LDA results</h2>
<p>Load the results of the LDA on topics.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>topic_labels <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">'_data/chatgpt/topic_labels_k10.csv'</span>))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>topic_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">'_output/lda_topic_k10.csv'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(topic_labels, <span class="at">by =</span> <span class="st">'topic'</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>top_prob_df <span class="ot">&lt;-</span> topic_df <span class="sc">%&gt;%</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(doc_id) <span class="sc">%&gt;%</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(prob <span class="sc">==</span> <span class="fu">max</span>(prob)) <span class="sc">%&gt;%</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="examine-term-frequency-across-all-abstracts" class="level2">
<h2 class="anchored" data-anchor-id="examine-term-frequency-across-all-abstracts">Examine term frequency across all abstracts</h2>
<p>This will function on the <em>lemmatized</em> abstracts created in the LDA script.</p>
<p>Across all abstracts in the results set, identify most commonly used words (whether keywords or search terms or otherwise), using a <span class="math inline">\(tf-idf\)</span> (term frequency x inverse doc frequency) approach, where <span class="math display">\[tf_{\text{word}} = \frac{n_{\text{word}}} {n_{\text{all words}}}\]</span> and <span class="math display">\[idf = \ln \left(\frac{n_{\text{abstracts}}}{n_{\text{abstracts containing term}}}\right)\]</span> or in other words, <span class="math display">\[idf = - \ln \left(\frac{n_{\text{abstracts containing terms}}}{n_{\text{abstracts}}}\right)\]</span></p>
<p>The product <span class="math inline">\(tf \times idf\)</span> indicates words that are relatively important to one abstract (based on frequency of the term within that abstract) within the overall collection of abstracts (based on how infrequently the term shows up in other abstracts). Terms that show up in all abstracts (e.g., stop words) will have an <span class="math inline">\(idf \rightarrow 0\)</span> equal to or near 0, as the ratio <span class="math inline">\(\rightarrow 1\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>lemma_dict_f <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">'_data/abstract_lemmatized.csv'</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(lemma_dict_f)) {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">'Lemmatized abstract file does not exist - run the LDA script to create it!'</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>abstr_lemmatized_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(lemma_dict_f) <span class="sc">%&gt;%</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">text =</span> abstr_lemma)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>abstr_words <span class="ot">&lt;-</span> abstr_lemmatized_df <span class="sc">%&gt;%</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(<span class="at">input =</span> text, <span class="at">output =</span> word, <span class="at">token =</span> <span class="st">'words'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words, <span class="at">by =</span> <span class="st">'word'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(doc_id, word) <span class="sc">%&gt;%</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(doc_id) <span class="sc">%&gt;%</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term_freq =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- ### Plot rank vs frequency -->
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>abstr_freq_by_rank <span class="ot">&lt;-</span> abstr_words <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(doc_id) <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(term_freq)) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'word'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(word) <span class="sc">&gt;</span> <span class="dv">2</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>rank_subset <span class="ot">&lt;-</span> abstr_freq_by_rank <span class="sc">%&gt;%</span> </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(rank <span class="sc">&lt;</span> <span class="dv">50</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>freq_rank_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log10</span>(term_freq) <span class="sc">~</span> <span class="fu">log10</span>(rank), <span class="at">data =</span> rank_subset)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Coefficients:</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># (Intercept)  log10(rank)  </span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">#     -1.1059      -0.7098</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(abstr_freq_by_rank <span class="sc">%&gt;%</span> <span class="fu">sample_n</span>(<span class="dv">2000</span>),</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> rank, <span class="at">y =</span> term_freq, <span class="at">color =</span> doc_id)) <span class="sc">+</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">size =</span> .<span class="dv">1</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> freq_rank_lm<span class="sc">$</span>coefficients[<span class="dv">1</span>],</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">slope =</span> freq_rank_lm<span class="sc">$</span>coefficients[<span class="dv">2</span>],</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">'dashed'</span>) <span class="sc">+</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="3_topic_tf_idf_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Zipf’s law: Frequency of a word is inversely proportional to rank… log-log plot shows a (basically) constant slope of -0.572 for terms ranked less than 50.</p>
<section id="calculate-idf-and-tf-idf" class="level3">
<h3 class="anchored" data-anchor-id="calculate-idf-and-tf-idf">Calculate <span class="math inline">\(idf\)</span> and <span class="math inline">\(tf-idf\)</span></h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>abstr_idf <span class="ot">&lt;-</span> abstr_words <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_abstr =</span> <span class="fu">n_distinct</span>(doc_id)) <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(word) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n_abstr_w_term =</span> <span class="fu">n_distinct</span>(doc_id),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_abstr =</span> <span class="fu">first</span>(n_abstr), <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">idf =</span> <span class="sc">-</span><span class="fu">log</span>(n_abstr_w_term <span class="sc">/</span> n_abstr))</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>abstr_tf_idf <span class="ot">&lt;-</span> abstr_words <span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(abstr_idf, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'word'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tf_idf =</span> term_freq <span class="sc">*</span> idf) <span class="sc">%&gt;%</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(tf_idf))</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>top_tf_idf_all_docs <span class="ot">&lt;-</span> abstr_tf_idf <span class="sc">%&gt;%</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(tf_idf, <span class="at">n =</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">c</span>(term_freq, idf, tf_idf), <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">round</span>(.x, <span class="dv">4</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(doc_id, word, term_freq, idf, tf_idf)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(top_tf_idf_all_docs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-df4c0c64536c1c45f1f6" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-df4c0c64536c1c45f1f6">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50"],[3776,5362,5540,7477,629,4952,3139,11678,7165,12076,3829,3057,5525,7680,6367,5283,3880,9664,5228,8267,11330,10248,8125,11793,996,4433,9693,1375,611,5823,6073,12071,12080,4628,1332,11272,5989,11179,489,6359,11406,735,10700,553,8346,5599,4421,5989,2192,698],["airnow","ptsc","telework","smfi","upgs","gear","reit","shd","meat","ginseng","pfe","epc","modularity","avalanche","underground","ewd","smfc","bcr","floater","hazelnut","slum","gomishan","mhealth","dmc","flcc","nstlr","vrn","poc","mariculture","drug","microrefugia","tt","potato","nsat","greenland","parking","gazelle","outstation","pr","coppice","propellant","qigong","alcohol","tsa","trem","cospec","library","railroad","flywheel","muscle"],[0.122,0.1195,0.1194,0.1089,0.106,0.1538,0.0997,0.1067,0.1261,0.09229999999999999,0.0985,0.1029,0.1125,0.1099,0.1463,0.0877,0.08699999999999999,0.08699999999999999,0.093,0.1,0.0994,0.08459999999999999,0.0833,0.1157,0.0825,0.0825,0.0824,0.09320000000000001,0.1037,0.124,0.082,0.0926,0.1238,0.0814,0.0973,0.1081,0.09429999999999999,0.08,0.1087,0.0905,0.112,0.0794,0.1048,0.1042,0.0785,0.0784,0.1294,0.09429999999999999,0.0781,0.0936],[9.4091,9.4091,8.715999999999999,9.4091,9.4091,6.2736,9.4091,8.715999999999999,7.0112,9.4091,8.715999999999999,8.310499999999999,7.4632,7.6173,5.6479,9.4091,9.4091,9.4091,8.715999999999999,8.0228,8.0228,9.4091,9.4091,6.7701,9.4091,9.4091,9.4091,8.310499999999999,7.4632,6.2311,9.4091,8.310499999999999,6.1902,9.4091,7.7997,7.0112,8.0228,9.4091,6.9242,8.310499999999999,6.7011,9.4091,7.1065,7.1065,9.4091,9.4091,5.6955,7.7997,9.4091,7.7997],[1.1475,1.1244,1.0407,1.0248,0.997,0.9651999999999999,0.9381,0.9297,0.8843,0.8685,0.8584000000000001,0.8555,0.8396,0.8371,0.8265,0.8254,0.8182,0.8182,0.8108,0.8023,0.7976,0.7958,0.7841,0.7833,0.7765,0.7765,0.7755,0.7743,0.7736,0.7724,0.7712,0.7695,0.7664,0.7659,0.7593,0.758,0.7569,0.7527,0.7526,0.7521,0.7504999999999999,0.7468,0.745,0.7403,0.7389,0.738,0.7371,0.7358,0.7351,0.7298]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>doc_id<\/th>\n      <th>word<\/th>\n      <th>term_freq<\/th>\n      <th>idf<\/th>\n      <th>tf_idf<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,3,4,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="word-frequency" class="level3">
<h3 class="anchored" data-anchor-id="word-frequency">Word frequency</h3>
<p>Visualize terms to find themes - exclude terms from the ESI and value terms. Also remove common but uninformative terms like “study”, “based”, and “management” that show up frequently.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>exclude_terms <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'value'</span>, <span class="st">'benefit'</span>, <span class="st">'satellite'</span>, </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'remote'</span>, <span class="st">'sensing'</span>, <span class="st">'spatial'</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'study'</span>, <span class="st">'analysis'</span>, <span class="st">'results'</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'based'</span>, <span class="st">'management'</span>, <span class="st">'model'</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'data'</span>, <span class="st">'information'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="at">collapse =</span> <span class="st">'|'</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>wordcloud_df <span class="ot">&lt;-</span> abstr_idf <span class="sc">%&gt;%</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'word'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(word, exclude_terms)) <span class="sc">%&gt;%</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(word) <span class="sc">&gt;</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(word, <span class="st">'[0-9]'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">doc_freq =</span> n_abstr_w_term <span class="sc">/</span> n_abstr) <span class="sc">%&gt;%</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> doc_freq, <span class="at">n =</span> <span class="dv">50</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(wordcloud_df, <span class="fu">aes</span>(<span class="at">label =</span> word, <span class="at">size =</span> doc_freq)) <span class="sc">+</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  ggwordcloud<span class="sc">::</span><span class="fu">geom_text_wordcloud</span>() <span class="sc">+</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="3_topic_tf_idf_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="examine-term-frequency-across-abstracts-by-topic" class="level2">
<h2 class="anchored" data-anchor-id="examine-term-frequency-across-abstracts-by-topic">Examine term frequency across abstracts, by topic</h2>
<p>Repeat the above analysis, except here grouping by topic to identify common words that show up in each topic.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>abstr_topic_df <span class="ot">&lt;-</span> abstr_lemmatized_df <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(top_prob_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'doc_id'</span>))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>abstr_topic_words <span class="ot">&lt;-</span> abstr_topic_df <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(<span class="at">input =</span> text, <span class="at">output =</span> word, <span class="at">token =</span> <span class="st">'words'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(doc_id, topic, label, word) <span class="sc">%&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(doc_id, topic) <span class="sc">%&gt;%</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term_freq =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="calculate-idf-and-tf-idf-1" class="level3">
<h3 class="anchored" data-anchor-id="calculate-idf-and-tf-idf-1">Calculate <span class="math inline">\(idf\)</span> and <span class="math inline">\(tf-idf\)</span></h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>abstr_topic_idf <span class="ot">&lt;-</span> abstr_topic_words <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(topic) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_abstr =</span> <span class="fu">n_distinct</span>(doc_id)) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(topic, label, word) <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n_abstr_w_term =</span> <span class="fu">n_distinct</span>(doc_id),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_abstr =</span> <span class="fu">first</span>(n_abstr), <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">idf =</span> <span class="sc">-</span><span class="fu">log</span>(n_abstr_w_term <span class="sc">/</span> n_abstr))</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>abstr_topic_tf_idf <span class="ot">&lt;-</span> abstr_topic_words <span class="sc">%&gt;%</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(abstr_topic_idf, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'topic'</span>, <span class="st">'label'</span>, <span class="st">'word'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tf_idf =</span> term_freq <span class="sc">*</span> idf) <span class="sc">%&gt;%</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(tf_idf))</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>top_tf_idf_by_topic <span class="ot">&lt;-</span> abstr_topic_tf_idf <span class="sc">%&gt;%</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(topic) <span class="sc">%&gt;%</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(tf_idf, <span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">c</span>(term_freq, idf, tf_idf), <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">round</span>(.x, <span class="dv">4</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(doc_id, topic, label, word, term_freq, idf, tf_idf)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(top_tf_idf_by_topic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-674f82dfc306dd98e23a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-674f82dfc306dd98e23a">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100"],[7477,629,1332,12076,3829,10248,9664,11330,8346,9652,4564,5989,6359,5989,611,11826,11179,2587,1155,3538,3776,4421,10000,1376,10000,5551,8487,11538,2462,6897,698,996,4433,4628,10573,8084,4108,4235,2690,8382,1847,2057,3111,4949,6944,5185,3498,2275,2894,4695,5362,7165,11678,5540,11272,418,1975,5228,972,6414,7680,695,1894,1375,10001,10388,11685,4128,1232,9696,8267,5283,6967,6073,9693,10633,12080,12032,5556,3901,7413,3057,10645,3450,5983,9165,292,4639,6181,7429,4952,3139,6367,11793,3880,1560,5525,4012,489,6641],["topic 1","topic 1","topic 1","topic 1","topic 1","topic 1","topic 1","topic 1","topic 1","topic 1","topic 10","topic 10","topic 10","topic 10","topic 10","topic 10","topic 10","topic 10","topic 10","topic 10","topic 2","topic 2","topic 2","topic 2","topic 2","topic 2","topic 2","topic 2","topic 2","topic 2","topic 3","topic 3","topic 3","topic 3","topic 3","topic 3","topic 3","topic 3","topic 3","topic 3","topic 4","topic 4","topic 4","topic 4","topic 4","topic 4","topic 4","topic 4","topic 4","topic 4","topic 5","topic 5","topic 5","topic 5","topic 5","topic 5","topic 5","topic 5","topic 5","topic 5","topic 6","topic 6","topic 6","topic 6","topic 6","topic 6","topic 6","topic 6","topic 6","topic 6","topic 7","topic 7","topic 7","topic 7","topic 7","topic 7","topic 7","topic 7","topic 7","topic 7","topic 8","topic 8","topic 8","topic 8","topic 8","topic 8","topic 8","topic 8","topic 8","topic 8","topic 9","topic 9","topic 9","topic 9","topic 9","topic 9","topic 9","topic 9","topic 9","topic 9"],["Urban Ecosystem Dynamics","Urban Ecosystem Dynamics","Urban Ecosystem Dynamics","Urban Ecosystem Dynamics","Urban Ecosystem Dynamics","Urban Ecosystem Dynamics","Urban Ecosystem Dynamics","Urban Ecosystem Dynamics","Urban Ecosystem Dynamics","Urban Ecosystem Dynamics","Coastal Habitat Conservation","Coastal Habitat Conservation","Coastal Habitat Conservation","Coastal Habitat Conservation","Coastal Habitat Conservation","Coastal Habitat Conservation","Coastal Habitat Conservation","Coastal Habitat Conservation","Coastal Habitat Conservation","Coastal Habitat Conservation","Forest Fire Management","Forest Fire Management","Forest Fire Management","Forest Fire Management","Forest Fire Management","Forest Fire Management","Forest Fire Management","Forest Fire Management","Forest Fire Management","Forest Fire Management","Satellite-Based Environmental Modeling","Satellite-Based Environmental Modeling","Satellite-Based Environmental Modeling","Satellite-Based Environmental Modeling","Satellite-Based Environmental Modeling","Satellite-Based Environmental Modeling","Satellite-Based Environmental Modeling","Satellite-Based Environmental Modeling","Satellite-Based Environmental Modeling","Satellite-Based Environmental Modeling","River Basin Management","River Basin Management","River Basin Management","River Basin Management","River Basin Management","River Basin Management","River Basin Management","River Basin Management","River Basin Management","River Basin Management","Air Pollution Impact Analysis","Air Pollution Impact Analysis","Air Pollution Impact Analysis","Air Pollution Impact Analysis","Air Pollution Impact Analysis","Air Pollution Impact Analysis","Air Pollution Impact Analysis","Air Pollution Impact Analysis","Air Pollution Impact Analysis","Air Pollution Impact Analysis","Landslide Prediction Modeling","Landslide Prediction Modeling","Landslide Prediction Modeling","Landslide Prediction Modeling","Landslide Prediction Modeling","Landslide Prediction Modeling","Landslide Prediction Modeling","Landslide Prediction Modeling","Landslide Prediction Modeling","Landslide Prediction Modeling","Vegetation &amp; Crop Analysis","Vegetation &amp; Crop Analysis","Vegetation &amp; Crop Analysis","Vegetation &amp; Crop Analysis","Vegetation &amp; Crop Analysis","Vegetation &amp; Crop Analysis","Vegetation &amp; Crop Analysis","Vegetation &amp; Crop Analysis","Vegetation &amp; Crop Analysis","Vegetation &amp; Crop Analysis","Remote Sensing &amp; Image Classification","Remote Sensing &amp; Image Classification","Remote Sensing &amp; Image Classification","Remote Sensing &amp; Image Classification","Remote Sensing &amp; Image Classification","Remote Sensing &amp; Image Classification","Remote Sensing &amp; Image Classification","Remote Sensing &amp; Image Classification","Remote Sensing &amp; Image Classification","Remote Sensing &amp; Image Classification","Satellite Technology Applications","Satellite Technology Applications","Satellite Technology Applications","Satellite Technology Applications","Satellite Technology Applications","Satellite Technology Applications","Satellite Technology Applications","Satellite Technology Applications","Satellite Technology Applications","Satellite Technology Applications"],["smfi","upgs","greenland","ginseng","pfe","gomishan","bcr","slum","trem","coalfield","farmland","railroad","coppice","gazelle","mariculture","qb","outstation","concession","microplastic","lionfish","airnow","library","chilling","ppas","injury","family","utc","wii","es","evacuation","muscle","flcc","nstlr","nsat","breakup","gypsum","gdv","mjo","nh3","iw","aral","bioecological","gw","coating","hydroponic","dust","mangrove","geowepp","malacca","tunnel","ptsc","meat","shd","telework","parking","manure","ugs","floater","quantum","recreational","avalanche","vwc","waterlogging","poc","front","team","stope","asm","greenhouse","typhoon","hazelnut","ewd","tea","microrefugia","vrn","esi","potato","ge","lichen","hemlock","ph","epc","lc","haze","cta","seabed","brine","oim","epc","hickory","gear","reit","underground","dmc","smfc","pcr","modularity","tourism","pr","mongolia"],[0.1078,0.1046,0.0948,0.0916,0.097,0.0829,0.0822,0.0977,0.07770000000000001,0.09089999999999999,0.1481,0.09089999999999999,0.08890000000000001,0.09089999999999999,0.1018,0.0805,0.0755,0.08260000000000001,0.0794,0.0709,0.1136,0.1272,0.0838,0.07439999999999999,0.1061,0.09379999999999999,0.0696,0.0694,0.1099,0.1014,0.0925,0.08169999999999999,0.08169999999999999,0.0809,0.0718,0.07140000000000001,0.07099999999999999,0.0702,0.0871,0.0667,0.08,0.0663,0.0808,0.0645,0.0645,0.0741,0.0737,0.0595,0.0588,0.0588,0.1166,0.125,0.1046,0.1159,0.1081,0.093,0.0924,0.09089999999999999,0.0969,0.1028,0.1026,0.0833,0.1005,0.092,0.08890000000000001,0.0862,0.07580000000000001,0.07530000000000001,0.0737,0.1129,0.1,0.08550000000000001,0.1037,0.08110000000000001,0.08110000000000001,0.0859,0.1221,0.0733,0.08699999999999999,0.0692,0.1073,0.1014,0.1148,0.1075,0.07870000000000001,0.0848,0.0764,0.07480000000000001,0.0818,0.0701,0.1515,0.0985,0.1429,0.1148,0.08550000000000001,0.09089999999999999,0.1071,0.1474,0.1031,0.09520000000000001],[7.5121,7.5121,7.5121,7.5121,6.8189,7.5121,7.5121,6.1258,7.5121,6.4135,4.7041,7.0067,7.0067,6.3135,5.6204,7.0067,7.0067,6.3135,6.3135,7.0067,7.1033,4.8007,7.1033,7.1033,4.9061,5.3116,7.1033,7.1033,4.4643,4.8007,6.3886,7.0817,7.0817,7.0817,7.0817,7.0817,7.0817,7.0817,5.6954,7.0817,5.9017,7.0003,5.614,7.0003,7.0003,5.9017,5.9017,7.0003,7.0003,7.0003,6.7754,6.0822,6.7754,6.0822,6.0822,6.7754,6.7754,6.7754,6.0822,5.6768,5.1743,6.2729,5.1743,5.5797,5.5797,5.5797,6.2729,6.2729,6.2729,3.9703,7.1349,7.1349,5.7486,7.1349,7.1349,6.4417,4.4958,7.1349,5.7486,7.1349,6.3682,6.3682,5.1154,5.2696,7.0613,6.3682,7.0613,7.0613,6.3682,7.0613,5.4884,7.5679,5.083,5.7761,7.5679,6.8747,5.7761,4.0415,5.7761,6.1816],[0.8101,0.7856,0.7124,0.6881,0.6615,0.623,0.6173999999999999,0.5985,0.5838,0.583,0.6969,0.637,0.6228,0.574,0.5721000000000001,0.5643,0.5288,0.5218,0.5011,0.4969,0.8072,0.6105,0.5953000000000001,0.5283,0.5208,0.498,0.4941,0.4933,0.4906,0.4866,0.5908,0.5788,0.5788,0.5731000000000001,0.5083,0.5058,0.5028,0.497,0.4963,0.4721,0.4721,0.4639,0.4537,0.4516,0.4516,0.4372,0.4349,0.4167,0.4118,0.4118,0.7897999999999999,0.7603,0.7085,0.7052,0.6575,0.6303,0.6263,0.6159,0.5895,0.5836,0.5306999999999999,0.5227000000000001,0.52,0.5135,0.496,0.481,0.4752,0.4722,0.4622,0.4483,0.7135,0.6098,0.5959,0.5785,0.5785,0.5536,0.5488,0.5232,0.4999,0.494,0.6834,0.646,0.587,0.5666,0.5554,0.5402,0.5394,0.5284,0.5207000000000001,0.495,0.8316,0.7455000000000001,0.7261,0.6627999999999999,0.6468,0.625,0.6189,0.5956,0.5955,0.5887]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>doc_id<\/th>\n      <th>topic<\/th>\n      <th>label<\/th>\n      <th>word<\/th>\n      <th>term_freq<\/th>\n      <th>idf<\/th>\n      <th>tf_idf<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="importantunique-words-that-show-up-across-multiple-topics" class="level3">
<h3 class="anchored" data-anchor-id="importantunique-words-that-show-up-across-multiple-topics">Important/unique words that show up across multiple topics</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(top_tf_idf_by_topic <span class="sc">%&gt;%</span> janitor<span class="sc">::</span><span class="fu">get_dupes</span>(word))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 5%">
<col style="width: 11%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 40%">
<col style="width: 10%">
<col style="width: 7%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">word</th>
<th style="text-align: right;">dupe_count</th>
<th style="text-align: right;">doc_id</th>
<th style="text-align: left;">topic</th>
<th style="text-align: left;">label</th>
<th style="text-align: right;">term_freq</th>
<th style="text-align: right;">idf</th>
<th style="text-align: right;">tf_idf</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">epc</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3057</td>
<td style="text-align: left;">topic 8</td>
<td style="text-align: left;">Remote Sensing &amp; Image Classification</td>
<td style="text-align: right;">0.1014</td>
<td style="text-align: right;">6.3682</td>
<td style="text-align: right;">0.6460</td>
</tr>
<tr class="even">
<td style="text-align: left;">epc</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">6181</td>
<td style="text-align: left;">topic 8</td>
<td style="text-align: left;">Remote Sensing &amp; Image Classification</td>
<td style="text-align: right;">0.0818</td>
<td style="text-align: right;">6.3682</td>
<td style="text-align: right;">0.5207</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>wordcloud_topic_df <span class="ot">&lt;-</span> abstr_topic_idf <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'word'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(word, exclude_terms)) <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(word) <span class="sc">&gt;</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(word, <span class="st">'[0-9]'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">doc_freq =</span> n_abstr_w_term <span class="sc">/</span> n_abstr) <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(topic, label) <span class="sc">%&gt;%</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> doc_freq, <span class="at">n =</span> <span class="dv">20</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(wordcloud_topic_df, <span class="fu">aes</span>(<span class="at">label =</span> word, <span class="at">size =</span> doc_freq)) <span class="sc">+</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  ggwordcloud<span class="sc">::</span><span class="fu">geom_text_wordcloud</span>() <span class="sc">+</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> label)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="3_topic_tf_idf_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="examine-value-bigram-frequency-across-abstracts" class="level2">
<h2 class="anchored" data-anchor-id="examine-value-bigram-frequency-across-abstracts">Examine “value” bigram frequency across abstracts</h2>
<p>Similar to above, except here, let’s break the abstracts into bigrams and focus on those that include one of the “value” search terms.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>abstr_bigrams_all <span class="ot">&lt;-</span> abstr_topic_df <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">### first divide sentences so bigrams don't continue over sentence breaks</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">text =</span> <span class="fu">str_split</span>(text, <span class="at">pattern =</span> <span class="st">'[.;]'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(text) <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">### now break into bigrams</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(<span class="at">input =</span> text, <span class="at">output =</span> bigram, <span class="at">token =</span> <span class="st">'ngrams'</span>, <span class="at">n =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(doc_id, topic, label, bigram) <span class="sc">%&gt;%</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(doc_id, topic) <span class="sc">%&gt;%</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bigram_freq =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(topic) <span class="sc">%&gt;%</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_bigrams =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>value_terms <span class="ot">&lt;-</span> <span class="st">'value|valuation|benefit|utility'</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>value_bigrams <span class="ot">&lt;-</span> abstr_bigrams_all <span class="sc">%&gt;%</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="do">### filter to keep those bigrams with an instance of a value term</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(bigram, value_terms)) <span class="sc">%&gt;%</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="do">### separate out for dropping stop words</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> bigram, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">'word1'</span>, <span class="st">'word2'</span>), <span class="at">sep =</span> <span class="st">' '</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  <span class="do">### drop rows where the initial or final word is a stop word</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'word1'</span> <span class="ot">=</span> <span class="st">'word'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'word2'</span> <span class="ot">=</span> <span class="st">'word'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  <span class="do">### drop rows where any term is less than three characters long</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(nchar(word1) &gt; 2 &amp; nchar(word2) &gt; 2) %&gt;%</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  <span class="do">### reunite the bigram</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="at">col =</span> <span class="st">'bigram'</span>, word1, word2, <span class="at">sep =</span> <span class="st">' '</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="calculate-idf-and-tf-idf-2" class="level3">
<h3 class="anchored" data-anchor-id="calculate-idf-and-tf-idf-2">Calculate <span class="math inline">\(idf\)</span> and <span class="math inline">\(tf-idf\)</span></h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>value_bigram_idf <span class="ot">&lt;-</span> value_bigrams <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(topic) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_abstr =</span> <span class="fu">n_distinct</span>(doc_id)) <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(topic, bigram) <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n_abstr_w_term =</span> <span class="fu">n_distinct</span>(doc_id),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_abstr =</span> <span class="fu">first</span>(n_abstr), <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">idf =</span> <span class="sc">-</span><span class="fu">log</span>(n_abstr_w_term <span class="sc">/</span> n_abstr))</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>value_bigram_tf_idf <span class="ot">&lt;-</span> value_bigrams <span class="sc">%&gt;%</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(value_bigram_idf, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'topic'</span>, <span class="st">'bigram'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tf_idf =</span> bigram_freq <span class="sc">*</span> idf) <span class="sc">%&gt;%</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(tf_idf))</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>top_tf_idf_by_topic <span class="ot">&lt;-</span> value_bigram_tf_idf <span class="sc">%&gt;%</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(topic) <span class="sc">%&gt;%</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(tf_idf, <span class="at">n =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">c</span>(bigram_freq, idf, tf_idf), <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">round</span>(.x, <span class="dv">4</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(doc_id, topic, label, bigram, bigram_freq, idf, tf_idf)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(top_tf_idf_by_topic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-923441e551ac1e53219f" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-923441e551ac1e53219f">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54"],[807,7576,4258,6173,5256,5527,11075,5527,11179,11179,11179,11962,11827,1138,10623,11962,11185,11724,11724,5683,10888,10888,11199,2057,2057,1457,4704,4704,115,11730,3969,3969,11730,12208,856,6049,1894,6193,10528,5283,1237,10982,6249,6249,10490,2336,3603,2334,10490,7410,1489,7410,6537,1489],["topic 1","topic 1","topic 1","topic 1","topic 1","topic 10","topic 10","topic 10","topic 10","topic 10","topic 10","topic 2","topic 2","topic 2","topic 2","topic 2","topic 3","topic 3","topic 3","topic 3","topic 3","topic 3","topic 3","topic 4","topic 4","topic 4","topic 4","topic 4","topic 5","topic 5","topic 5","topic 5","topic 5","topic 6","topic 6","topic 6","topic 6","topic 6","topic 7","topic 7","topic 7","topic 7","topic 7","topic 7","topic 8","topic 8","topic 8","topic 8","topic 8","topic 9","topic 9","topic 9","topic 9","topic 9"],["Urban Ecosystem Dynamics","Urban Ecosystem Dynamics","Urban Ecosystem Dynamics","Urban Ecosystem Dynamics","Urban Ecosystem Dynamics","Coastal Habitat Conservation","Coastal Habitat Conservation","Coastal Habitat Conservation","Coastal Habitat Conservation","Coastal Habitat Conservation","Coastal Habitat Conservation","Forest Fire Management","Forest Fire Management","Forest Fire Management","Forest Fire Management","Forest Fire Management","Satellite-Based Environmental Modeling","Satellite-Based Environmental Modeling","Satellite-Based Environmental Modeling","Satellite-Based Environmental Modeling","Satellite-Based Environmental Modeling","Satellite-Based Environmental Modeling","Satellite-Based Environmental Modeling","River Basin Management","River Basin Management","River Basin Management","River Basin Management","River Basin Management","Air Pollution Impact Analysis","Air Pollution Impact Analysis","Air Pollution Impact Analysis","Air Pollution Impact Analysis","Air Pollution Impact Analysis","Landslide Prediction Modeling","Landslide Prediction Modeling","Landslide Prediction Modeling","Landslide Prediction Modeling","Landslide Prediction Modeling","Vegetation &amp; Crop Analysis","Vegetation &amp; Crop Analysis","Vegetation &amp; Crop Analysis","Vegetation &amp; Crop Analysis","Vegetation &amp; Crop Analysis","Vegetation &amp; Crop Analysis","Remote Sensing &amp; Image Classification","Remote Sensing &amp; Image Classification","Remote Sensing &amp; Image Classification","Remote Sensing &amp; Image Classification","Remote Sensing &amp; Image Classification","Satellite Technology Applications","Satellite Technology Applications","Satellite Technology Applications","Satellite Technology Applications","Satellite Technology Applications"],["environment benefit","climatic benefit","evaluation wetland","storage valuation","radiation benefit","regulation benefit","social benefit","benefit resource","benefit connection","benefit position","family benefit","inventory benefit","socioeconomic benefit","critical benefit","realize benefit","benefit national","evaluation framework","predict utility","utility noaa","utility dataset","quality utility","utility spaceborne","relative utility","bioecological benefit","benefit gi","benefit identify","benefit receive","proportional benefit","benefit poor","benefit analysis","benefit compliance","impact benefit","cost benefit","land valuation","ecological benefit","utility function","benefit waterlogging","evaluation index","yield benefit","evaluation ewd","crop utility","benefit improve","synergy utility","utility adaptive","benefit obtain","corner eigenvalue","advantage benefit","fractal eigenvalue","benefit result","utility tunnel","benefit china","cable utility","utility advanced","social benefit"],[0.0566,0.0297,0.0353,0.0263,0.0255,0.025,0.0328,0.025,0.0208,0.0208,0.0208,0.0357,0.0367,0.0303,0.0333,0.0357,0.0256,0.025,0.025,0.0241,0.0169,0.0169,0.0169,0.06619999999999999,0.0265,0.0278,0.0213,0.0213,0.0364,0.0698,0.0333,0.0333,0.0698,0.0432,0.0492,0.0345,0.0321,0.0465,0.0351,0.0185,0.0192,0.0169,0.0164,0.0164,0.0323,0.0296,0.0294,0.0291,0.0323,0.09719999999999999,0.0566,0.0417,0.038,0.0755],[5.536,6.6346,5.536,6.6346,6.6346,6.2538,4.4621,5.5607,6.2538,6.2538,6.2538,6.4785,5.3799,6.4785,5.7854,5.3799,5.8749,5.8749,5.8749,5.8749,5.8749,5.8749,5.8749,5.8608,5.8608,4.7622,5.8608,5.8608,6.1334,2.9553,6.1334,5.0348,2.3722,4.9836,3.5973,4.9836,4.9836,2.7864,4.349,5.9584,5.2653,5.9584,5.9584,5.9584,6.0162,6.0162,6.0162,6.0162,5.323,6.4922,6.4922,7.1854,7.1854,3.5745],[0.3134,0.1971,0.1954,0.1746,0.1695,0.1563,0.1463,0.139,0.1303,0.1303,0.1303,0.2314,0.1974,0.1963,0.1928,0.1921,0.1506,0.1469,0.1469,0.1416,0.09959999999999999,0.09959999999999999,0.09959999999999999,0.3881,0.1553,0.1323,0.1247,0.1247,0.223,0.2062,0.2044,0.1678,0.1655,0.2153,0.1769,0.1718,0.1599,0.1296,0.1526,0.1103,0.1013,0.101,0.0977,0.0977,0.1941,0.1783,0.1769,0.1749,0.1717,0.6312,0.3675,0.2994,0.2729,0.2698]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>doc_id<\/th>\n      <th>topic<\/th>\n      <th>label<\/th>\n      <th>bigram<\/th>\n      <th>bigram_freq<\/th>\n      <th>idf<\/th>\n      <th>tf_idf<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="examine-value-trigram-frequency-across-abstracts" class="level2">
<h2 class="anchored" data-anchor-id="examine-value-trigram-frequency-across-abstracts">Examine “value” trigram frequency across abstracts</h2>
<p>Similar to above, except here, let’s break the abstracts into _tri_grams and focus on those that include one of the “value” search terms.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>abstr_trigrams_all <span class="ot">&lt;-</span> abstr_topic_df <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">### first divide sentences so trigrams don't continue over sentence breaks</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">text =</span> <span class="fu">str_split</span>(text, <span class="at">pattern =</span> <span class="st">'[.;]'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(text) <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">### now break into trigrams</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(<span class="at">input =</span> text, <span class="at">output =</span> trigram, <span class="at">token =</span> <span class="st">'ngrams'</span>, <span class="at">n =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(doc_id, topic, label, trigram) <span class="sc">%&gt;%</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(doc_id, topic) <span class="sc">%&gt;%</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trigram_freq =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(topic) <span class="sc">%&gt;%</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_trigrams =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>value_terms <span class="ot">&lt;-</span> <span class="st">'value|valuation|benefit|utility'</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>value_trigrams <span class="ot">&lt;-</span> abstr_trigrams_all <span class="sc">%&gt;%</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="do">### filter to keep those trigrams with an instance of a value term</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(trigram, value_terms)) <span class="sc">%&gt;%</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  <span class="do">### separate out for dropping stop words</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> trigram, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">'word1'</span>, <span class="st">'word2'</span>, <span class="st">'word3'</span>), <span class="at">sep =</span> <span class="st">' '</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  <span class="do">### drop rows where the initial or final word is a stop word</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'word1'</span> <span class="ot">=</span> <span class="st">'word'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(stop_words, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'word3'</span> <span class="ot">=</span> <span class="st">'word'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>  <span class="do">### drop rows where any term is less than three characters long</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(nchar(word1) &gt; 2 &amp; nchar(word2) &gt; 2) %&gt;%</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>  <span class="do">### reunite the trigram</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="at">col =</span> <span class="st">'trigram'</span>, word1, word2, word3, <span class="at">sep =</span> <span class="st">' '</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="calculate-idf-and-tf-idf-3" class="level3">
<h3 class="anchored" data-anchor-id="calculate-idf-and-tf-idf-3">Calculate <span class="math inline">\(idf\)</span> and <span class="math inline">\(tf-idf\)</span></h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>value_trigram_idf <span class="ot">&lt;-</span> value_trigrams <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(topic) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_abstr =</span> <span class="fu">n_distinct</span>(doc_id)) <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(topic, trigram) <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n_abstr_w_term =</span> <span class="fu">n_distinct</span>(doc_id),</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_abstr =</span> <span class="fu">first</span>(n_abstr), <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">idf =</span> <span class="sc">-</span><span class="fu">log</span>(n_abstr_w_term <span class="sc">/</span> n_abstr))</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>value_trigram_tf_idf <span class="ot">&lt;-</span> value_trigrams <span class="sc">%&gt;%</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(value_trigram_idf, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'topic'</span>, <span class="st">'trigram'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tf_idf =</span> trigram_freq <span class="sc">*</span> idf) <span class="sc">%&gt;%</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(tf_idf))</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>top_tf_idf_by_topic <span class="ot">&lt;-</span> value_trigram_tf_idf <span class="sc">%&gt;%</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(topic) <span class="sc">%&gt;%</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(tf_idf, <span class="at">n =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">c</span>(trigram_freq, idf, tf_idf), <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">round</span>(.x, <span class="dv">4</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(doc_id, topic, trigram, trigram_freq, idf, tf_idf)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(top_tf_idf_by_topic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-7fdacaed4b02a4b717fb" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-7fdacaed4b02a4b717fb">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60"],[807,7576,6173,7778,8037,8037,5527,5527,5527,1252,11179,11179,11179,11179,11962,11962,11962,1138,1138,1138,10623,11724,11724,11724,8977,8353,11199,11199,11199,1457,1457,1457,2057,2057,11730,3969,3969,3969,1704,1894,7831,7831,7831,856,10117,7465,8035,847,3857,10490,10490,10490,3603,3603,3603,1489,1489,6641,7410,7410],["topic 1","topic 1","topic 1","topic 1","topic 1","topic 1","topic 10","topic 10","topic 10","topic 10","topic 10","topic 10","topic 10","topic 10","topic 2","topic 2","topic 2","topic 2","topic 2","topic 2","topic 2","topic 3","topic 3","topic 3","topic 3","topic 3","topic 3","topic 3","topic 3","topic 4","topic 4","topic 4","topic 4","topic 4","topic 5","topic 5","topic 5","topic 5","topic 5","topic 6","topic 6","topic 6","topic 6","topic 6","topic 7","topic 7","topic 7","topic 7","topic 7","topic 8","topic 8","topic 8","topic 8","topic 8","topic 8","topic 9","topic 9","topic 9","topic 9","topic 9"],["eco environment benefit","environmental climatic benefit","carbon storage valuation","urban farming benefit","benefit nanjing city","paper benefit nanjing","benefit resource term","hunting regulation benefit","regulation benefit resource","benefit spatial protection","benefit connection bring","benefit position context","family benefit connection","outstation family benefit","benefit national management","inventory benefit national","prepare inventory benefit","benefit include enhanced","critical benefit include","yield critical benefit","realize benefit remote","calculation predict utility","predict utility noaa","utility noaa advance","spi value record","discharge value simulate","art relative utility","relative utility satellite","utility satellite precipitation","benefit identify geoss","relate societal benefit","societal benefit identify","benefit gi practice","bioecological benefit gi","cost benefit analysis","benefit compliance brewing","examine impact benefit","impact benefit compliance","global health benefit","benefit waterlogging control","benefit worth popularize","nice social benefit","social benefit worth","ecological benefit greening","interpolation value 0","reflectance value derive","count value fds","ndvi value decrease","manage resource benefit","benefit obtain technique","benefit result characteristic","cost benefit obtain","advantage benefit technology","assess advantage benefit","benefit technology justify","benefit china earth","social benefit china","technology value application","cable utility tunnel","electrical cable utility"],[0.0629,0.0349,0.0303,0.0283,0.027,0.027,0.0278,0.0278,0.0278,0.0233,0.0233,0.0233,0.0233,0.0233,0.0385,0.0385,0.0385,0.0357,0.0357,0.0357,0.0357,0.0286,0.0286,0.0286,0.0189,0.0185,0.0185,0.0185,0.0185,0.0303,0.0303,0.0303,0.0292,0.0292,0.0779,0.037,0.037,0.037,0.0278,0.0345,0.027,0.027,0.027,0.0256,0.0316,0.0345,0.0244,0.0222,0.02,0.037,0.037,0.037,0.0333,0.0333,0.0333,0.0625,0.0625,0.0556,0.0448,0.0448],[7.0716,7.0716,7.0716,7.0716,7.0716,7.0716,6.5806,6.5806,6.5806,6.5806,6.5806,6.5806,6.5806,6.5806,6.713,6.713,6.713,6.713,6.713,6.713,6.713,6.8068,6.8068,6.8068,6.8068,6.8068,6.8068,6.8068,6.8068,6.6386,6.6386,6.6386,6.6386,6.6386,3.3288,6.3733,6.3733,6.3733,6.3733,5.8051,5.8051,5.8051,5.8051,5.8051,6.8405,5.7419,6.8405,6.8405,6.8405,6.6425,6.6425,6.6425,6.6425,6.6425,6.6425,7.2521,7.2521,7.2521,7.2521,7.2521],[0.4451,0.2467,0.2143,0.2001,0.1911,0.1911,0.1828,0.1828,0.1828,0.153,0.153,0.153,0.153,0.153,0.2582,0.2582,0.2582,0.2397,0.2397,0.2397,0.2397,0.1945,0.1945,0.1945,0.1284,0.1261,0.1261,0.1261,0.1261,0.2012,0.2012,0.2012,0.1938,0.1938,0.2594,0.236,0.236,0.236,0.177,0.2002,0.1569,0.1569,0.1569,0.1488,0.216,0.198,0.1668,0.152,0.1368,0.246,0.246,0.246,0.2214,0.2214,0.2214,0.4533,0.4533,0.4029,0.3247,0.3247]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>doc_id<\/th>\n      <th>topic<\/th>\n      <th>trigram<\/th>\n      <th>trigram_freq<\/th>\n      <th>idf<\/th>\n      <th>tf_idf<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,4,5,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>