---
title: 'Web of Science clean bibtex'
format: 
  html:
    code-fold: true
    code-summary: "Show me the code"
execute:
  echo: true
  warning: false
  message: false
editor: source
---

```{r setup}
library(tidyverse)
library(tidytext)
library(bib2df)
library(here)

source(here('common_fxns.R'))
```

## Description

This script cleans bibtex files from Web of Science and the CONVEI Zotero library.

### Cleaning the bibtex

The Web of Science records contain line breaks that disrupt the ability of the `bib2df` package to work properly. Replace those problematic line breaks (a carriage return `\r`, followed by a line break `\n`, followed by a three-space indentation) with a single blank space.

```{r clean bibtex}
bib_raw_fs <- list.files(here('_data/bibtex_raw'), pattern = '.bib$', full.names = TRUE)
for(f in bib_raw_fs) {
  # f <- bib_raw_fs[7]
  bib_raw <- read_file(f)
  bib_clean <- str_replace_all(bib_raw, '(\\r)?\\n   ', ' ')
  f_out <- str_replace(f, '_raw', '_clean')
  write_file(bib_clean, f_out)
}
```
